<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<muclient>
<plugin
  name="Heracles_Pup_Tracker"
  author="Heracles"
  id="87de24dc0b84faae4729ffb8"
  language="Lua"
  purpose="Automatic Pup Tracking"
  save_state="y"
  date_written="2026-01-24"
  requires="5.06"
  version="15.4"
  >
</plugin>

<timers>
  <timer name="tmPulse" enabled="y" second="1" script="TmrPulse" />
</timers>

<aliases>
  <alias match="^pt chan (.+)$" script="tracker_settings" enabled="y" regexp="y" sequence="100" />
  <alias match="^pt log (.+)$" script="tracker_log_settings" enabled="y" regexp="y" sequence="100" />
  <alias match="^pt debug$" script="ToggleDebug" enabled="y" regexp="y" sequence="100" />
  <alias match="^pt help$" script="pt_help" enabled="y" regexp="y" sequence="100" />
  <alias match="^pt track$" script="ToggleTrack" enabled="y" regexp="y" sequence="100" />
  <alias match="^pt report (.+)$" script="ManualReport" enabled="y" regexp="y" sequence="100" />
  <alias match="^pt list (\d+)$" script="ShowDailyHistory" enabled="y" regexp="y" sequence="100" />
  <alias match="^pt list date (.+) to (.+)$" script="ShowDailyRange" enabled="y" regexp="y" sequence="100" />
  <alias match="^pt summary (\d+)$" script="ShowTotalHistory" enabled="y" regexp="y" sequence="100" />
  <alias match="^pt summary date (.+) to (.+)$" script="ShowRangeHistory" enabled="y" regexp="y" sequence="100" />
  <alias match="^pt gold$" script="ShowGoldSummary" enabled="y" regexp="y" sequence="100" />
</aliases>

<triggers>
  <trigger enabled="y" match="Congratulations, *. You have increased your powerups to *." script="TrgPup" sequence="100" />
  <trigger enabled="y" match="You gain * trains." name="pupgains" script="TrgPupGains" group="trgLevelInfo" sequence="100" />
  <trigger enabled="y" regexp="y" match="^Lucky! You gain an extra (\d) training sessions?!$" name="bonusgains" script="TrgPupGains" group="trgLevelInfo" sequence="100" />
  <trigger enabled="y" regexp="y" match="^You gain (.*) extra(?: trains)? daily blessing bonus.$" name="blessingtrains" script="TrgPupGains" group="trgLevelInfo" sequence="100" />
  <trigger enabled="y" regexp="y" match="^$" name="trgFinish" script="TrgFinish" sequence="100" />
  
  <trigger enabled="y" regexp="y" match="^.*? crumbles into ([\d,]+) gold pieces\.$" script="TrgGoldCrumble" sequence="10" />
  <trigger enabled="y" regexp="y" match="^You get ([\d,]+) gold coins from .*?\.$" script="TrgGoldCorpse" sequence="10" />
  <trigger enabled="y" regexp="y" match="^.*? shares [\d,]+ gold coins with you\. Your share is ([\d,]+) gold\.$" script="TrgGoldSplit" sequence="10" />
  <trigger enabled="y" regexp="y" match="^\w+ gives you ([\d,]+) gold coins for .*?\.$" script="TrgGoldSac" sequence="10" />
  <trigger enabled="y" regexp="y" match="^You sell .*? to .*? for ([\d,]+) gold\.$" script="TrgGoldSell" sequence="10" />
  <trigger enabled="y" regexp="y" match="^You haggle with .*? for an extra ([\d,]+) gold\.$" script="TrgGoldHaggle" sequence="10" />

  <trigger enabled="y" regexp="y" match="^You share ([\d,]+) gold coins with .*? member.*? Your share is ([\d,]+) gold\.$" script="TrgGoldSubtract" sequence="5" />
  <trigger enabled="y" regexp="y" match="^You receive (\d+)(?:\+(\d+))?(?:\+(\d+))? experience points?\.$" name="trgMobExp" script="TrgExp" sequence="100" />
</triggers>

<script>
<![CDATA[
require "serialize"

local history, today_times, daily_archive = {}, {}, {}
local rep_chan, log_tab, t_date = "print", "", ""
local t_trains, t_pups, t_gold = 0, 0, 0
local g_corpse, g_crumble, g_split, g_sac, g_sell, g_haggle = 0, 0, 0, 0, 0, 0
local last_pup_time = 0
local debug_mode = false

local report_active, report_start_time = false, 0
local fiveMinStats = { pups = 0, trains = 0, gold = 0, times = {} }
local newPup = { trains = 0, bonus = 0, kills = 0, gold = 0 }

-- UTILITY FUNCTIONS
function CommaValue(n)
    local f = tostring(math.floor(math.abs(n)))
    local sign = n < 0 and "-" or ""
    while true do f, k = string.gsub(f, "^(-?%d+)(%d%d%d)", '%1,%2'); if (k==0) then break end end
    return sign .. f
end

function FormatGold(v)
    local sign = v < 0 and "-" or ""
    local val = math.abs(v)
    if val >= 1000000 then return sign .. string.format("%.2fM", val/1000000)
    elseif val >= 10000 then return sign .. string.format("%.1fK", val/1000)
    else return CommaValue(v) end
end

function FormatSeconds(s)
    s = math.floor(s)
    local m = math.floor(s/60)
    if m > 0 then return string.format("%02dm %02ds", m, s%60) end
    return string.format("%02ds", s)
end

function Pad(v, len)
    local str = tostring(v)
    return string.rep(" ", math.max(0, len - #str)) .. str
end

function GetLine(label, pups, trains, gold, avg)
    return string.format("@C%-11s @R| @DPups: @W%s @R| @DTrns: @W%s @R| @DGold: @Y%s @R| @DAvg: @W%s", 
           label, Pad(CommaValue(pups), 6), Pad(CommaValue(trains), 6), Pad(FormatGold(gold), 7), FormatSeconds(avg or 0))
end

-- TRACKING LOGIC & DEBUG
function ToggleDebug()
    debug_mode = not debug_mode
    AnsiNote("@R[ @WHeracles @R] @DDebug Mode: " .. (debug_mode and "@GENABLED" or "@RDISABLED"))
end

function DebugMsg(msg)
    if debug_mode then AnsiNote("@D[@WDEBUG@D] " .. msg) end
end

function TrgGoldCrumble(name, line, w)
    local amt = tonumber((string.gsub(w[1], ",", ""))) or 0
    g_crumble = g_crumble + amt
    DebugMsg(string.format("@GADDING CRUMBLE: @W%s @D(Source: %s)", CommaValue(amt), line))
    AdjustGold(amt)
end

function TrgGoldCorpse(name, line, w)
    local amt = tonumber((string.gsub(w[1], ",", ""))) or 0
    g_corpse = g_corpse + amt
    DebugMsg(string.format("@GADDING CORPSE: @W%s @D(Source: %s)", CommaValue(amt), line))
    AdjustGold(amt)
end

function TrgGoldSplit(name, line, w)
    local amt = tonumber((string.gsub(w[1], ",", ""))) or 0
    g_split = g_split + amt
    DebugMsg(string.format("@GADDING SPLIT: @W%s @D(Source: %s)", CommaValue(amt), line))
    AdjustGold(amt)
end

function TrgGoldSac(name, line, w)
    local amt = tonumber((string.gsub(w[1], ",", ""))) or 0
    g_sac = g_sac + amt
    DebugMsg(string.format("@GADDING SAC: @W%s @D(Source: %s)", CommaValue(amt), line))
    AdjustGold(amt)
end

function TrgGoldSell(name, line, w)
    local amt = tonumber((string.gsub(w[1], ",", ""))) or 0
    g_sell = g_sell + amt
    DebugMsg(string.format("@GADDING SALE: @W%s @D(Source: %s)", CommaValue(amt), line))
    AdjustGold(amt)
end

function TrgGoldHaggle(name, line, w)
    local amt = tonumber((string.gsub(w[1], ",", ""))) or 0
    g_haggle = g_haggle + amt
    DebugMsg(string.format("@GADDING HAGGLE: @W%s @D(Source: %s)", CommaValue(amt), line))
    AdjustGold(amt)
end

function TrgGoldSubtract(name, line, w)
    local total_shared = tonumber((string.gsub(w[1], ",", ""))) or 0
    local my_share = tonumber((string.gsub(w[2], ",", ""))) or 0
    local deduction = total_shared - my_share
    g_split = g_split - deduction
    DebugMsg(string.format("@RSUBTRACTING: @W%s @D(Total: %s, Kept: %s)", CommaValue(deduction), CommaValue(total_shared), CommaValue(my_share)))
    AdjustGold(-deduction)
end

function AdjustGold(amt)
    if not newPup then newPup = { trains = 0, bonus = 0, kills = 0, gold = 0 } end
    newPup.gold = (newPup.gold or 0) + amt
    t_gold = (t_gold or 0) + amt
    if report_active then fiveMinStats.gold = fiveMinStats.gold + amt end
    DebugMsg(string.format("@CPup Gold: @W%s @R| @CDaily Gold: @W%s", CommaValue(newPup.gold), CommaValue(t_gold)))
end

function GetServerDate()
    -- UTC anchor (!) minus 18,000 seconds (5 hours) for EST
    return os.date("!%d %b %Y", os.time() - 18000)
end

function CleanDate(s)
    local month_map = {["01"]="Jan",["02"]="Feb",["03"]="Mar",["04"]="Apr",["05"]="May",["06"]="Jun",["07"]="Jul",["08"]="Aug",["09"]="Sep",["10"]="Oct",["11"]="Nov",["12"]="Dec"}
    local d,m,y = s:match("^(%d%d) (%d%d) (%d%d%d%d)$")
    if d and m and y then return d.." "..month_map[m].." "..y end
    return s
end

function GetFullSet()
    local full = {}
    for _,v in ipairs(daily_archive) do table.insert(full, v) end
    local sTime = 0; for _,v in ipairs(today_times) do sTime = sTime + v end
    local avgToday = (#today_times > 0) and (sTime / #today_times) or 0
    table.insert(full, { date = t_date, pups = t_pups, trains = t_trains, gold = t_gold, avg = avgToday, time_count = #today_times })
    return full
end

-- CORE REPORTING FUNCTIONS
function ShowGoldSummary()
    local function GetPerc(v)
        if t_gold <= 0 then return "0" end
        return string.format("%.1f", (v / t_gold) * 100)
    end
    local sources = {
        { name = "Corpse Loot",   val = g_corpse },
        { name = "Crumble Gold",  val = g_crumble },
        { name = "Group Splits",  val = g_split },
        { name = "Autosac/Deity", val = g_sac },
        { name = "Shop Sales",    val = g_sell },
        { name = "Haggle Extra",  val = g_haggle }
    }
    table.sort(sources, function(a, b) return a.val > b.val end)
    PrintHeader("DAILY GOLD BREAKDOWN (SORTED)")
    for _, s in ipairs(sources) do
        AnsiNote(string.format("  @D%-15s: @Y%15s @D[%s%%]", s.name, CommaValue(s.val), GetPerc(s.val)))
    end
    AnsiNote("  " .. string.rep("@D-", 45))
    AnsiNote(string.format("  @WTotal Earnings:   @Y%15s", CommaValue(t_gold)))
    AnsiNote("@R" .. string.rep("-", 80))
end

function ShowDailyHistory(name, line, wildcards)
    local full = GetFullSet(); local count = math.min(tonumber(wildcards[1]), #full)
    PrintHeader("DAILY BREAKDOWN (LAST " .. count .. " DAYS)")
    for i = #full, #full - count + 1, -1 do
        local d = full[i]
        AnsiNote(GetLine(d.date, d.pups, d.trains, d.gold, d.avg))
    end
    AnsiNote("@R" .. string.rep("-", 80))
end

function ShowDailyRange(name, line, wildcards)
    local sDate, eDate = CleanDate(wildcards[1]), CleanDate(wildcards[2])
    local full, results, inRange = GetFullSet(), {}, false
    for _, d in ipairs(full) do
        if CleanDate(d.date) == sDate then inRange = true end
        if inRange then table.insert(results, d) end
        if CleanDate(d.date) == eDate then inRange = false end
    end
    PrintHeader("DAILY RANGE (" .. sDate .. " to " .. eDate .. ")")
    for i = #results, 1, -1 do
        local d = results[i]
        AnsiNote(GetLine(d.date, d.pups, d.trains, d.gold, d.avg))
    end
    AnsiNote("@R" .. string.rep("-", 80))
end

function ShowTotalHistory(name, line, wildcards)
    local full = GetFullSet(); local count = math.min(tonumber(wildcards[1]), #full)
    local sPups, sTrains, sGold, totalSeconds, totalCount = 0, 0, 0, 0, 0
    for i = #full, #full - count + 1, -1 do
        local d = full[i]
        sPups, sTrains, sGold = sPups + d.pups, sTrains + d.trains, sGold + d.gold
        totalSeconds = totalSeconds + ((d.avg or 0) * (d.time_count or 0)); totalCount = totalCount + (d.time_count or 0)
    end
    PrintHeader("TOTAL SUMMARY (LAST " .. count .. " DAYS)")
    AnsiNote(GetLine("TOTALS", sPups, sTrains, sGold, (totalCount > 0 and totalSeconds / totalCount or 0)))
    AnsiNote("@R" .. string.rep("-", 80))
end

function ShowRangeHistory(name, line, wildcards)
    local sDate, eDate = CleanDate(wildcards[1]), CleanDate(wildcards[2])
    local full, sPups, sTrains, sGold, totalSeconds, totalCount, inRange = GetFullSet(), 0, 0, 0, 0, 0, false
    for _, d in ipairs(full) do
        if CleanDate(d.date) == sDate then inRange = true end
        if inRange then
            sPups, sTrains, sGold = sPups + d.pups, sTrains + d.trains, sGold + d.gold
            totalSeconds = totalSeconds + ((d.avg or 0) * (d.time_count or 0)); totalCount = totalCount + (d.time_count or 0)
        end
        if CleanDate(d.date) == eDate then inRange = false end
    end
    PrintHeader("RANGE SUMMARY (" .. sDate .. " to " .. eDate .. ")")
    AnsiNote(GetLine("TOTALS", sPups, sTrains, sGold, (totalCount > 0 and totalSeconds / totalCount or 0)))
    AnsiNote("@R" .. string.rep("-", 80))
end

-- PUP TRIGGER PROCESSING
function TrgPup(name, line, w)
    newPup.finishTime = GetInfo(304)
    EnableTriggerGroup("trgLevelInfo", true)
    EnableTrigger("trgFinish", true)
end

function TrgPupGains(name, line, w)
    local amt = tonumber(w[1]) or 0
    if name == "pupgains" then newPup.trains = amt else newPup.bonus = newPup.bonus + amt end
end

function TrgExp(name, line, w) newPup.kills = (newPup.kills or 0) + 1 end

function TrgFinish(name, line, w)
    if (newPup.trains or 0) > 0 then
        EnableTriggerGroup("trgLevelInfo", false)
        EnableTrigger("trgFinish", false)
        local pTime = math.max(0, newPup.finishTime - last_pup_time)
        local totalTrains = newPup.trains + newPup.bonus
        if pTime <= 60 then
            table.insert(history, pTime)
            if #history > 10 then table.remove(history, 1) end
            table.insert(today_times, pTime)
            if report_active then table.insert(fiveMinStats.times, pTime) end
        end
        if report_active then
            fiveMinStats.pups = fiveMinStats.pups + 1
            fiveMinStats.trains = fiveMinStats.trains + totalTrains
        end
        t_pups = t_pups + 1; t_trains = t_trains + totalTrains
        BroadcastPup(pTime, totalTrains)
        last_pup_time = GetInfo(304)
        newPup = { trains = 0, bonus = 0, kills = 0, gold = 0 }
        SaveState()
    end
end

function BroadcastPup(pTime, totalTrains)
    local s1=0; for _,v in ipairs(history) do s1=s1+v end
    local s2=0; for _,v in ipairs(today_times) do s2=s2+v end
    local color_msg = string.format("@R[@DPup: @W%s@R] [@DTime: @W%s@R] [@DAvg: @W%s @DTdy: @W%s@R] [@DMobs: @W%02d@R] [@DTrns: @W%02d @DTdy: @W%s@R] [@DGold: @Y%s @DTdy: @Y%s@R]", 
                      CommaValue(t_pups), FormatSeconds(pTime), FormatSeconds(#history>0 and s1/#history or 0), FormatSeconds(#today_times>0 and s2/#today_times or 0), 
                      newPup.kills or 0, totalTrains, CommaValue(t_trains), Pad(FormatGold(newPup.gold or 0), 7), FormatGold(t_gold))
    OutputMessage(color_msg)
end

function OutputMessage(msg)
    if rep_chan == "print" then AnsiNote(msg)
    elseif rep_chan ~= "none" then Execute(rep_chan .. " " .. msg) end
    if log_tab ~= "" then CallPlugin("b555825a4a5700c35fa80780", "storeFromOutside", msg, log_tab) end
end

local timer_count = 0

function TmrPulse()
    if not initialized then return end
    
    timer_count = timer_count + 1
    local current_server_date = GetServerDate()
    
    -- 1. HANDLE EST DATE ROLLOVER
    if t_date ~= current_server_date then
        if debug_mode then
            AnsiNote("@D[Debug] EST Rollover detected. Archiving " .. t_date .. " and moving to " .. current_server_date)
        end

        if t_pups > 0 or t_trains > 0 then
            local s = 0
            for _, v in ipairs(today_times) do s = s + v end
            local avg = (#today_times > 0) and (s / #today_times) or 0
            
            table.insert(daily_archive, 1, {
                date = t_date,
                pups = t_pups,
                trains = t_trains,
                gold = t_gold,
                avg = math.floor(avg)
            })
            
            while #daily_archive > 10 do table.remove(daily_archive) end
        end
        
        t_date = current_server_date
        t_pups, t_trains, t_gold = 0, 0, 0
        today_times = {}
        SaveState()
    end

    -- 2. HANDLE 5-MINUTE REPORTING (300 Seconds)
    if timer_count >= 300 then
        if debug_mode then
            AnsiNote("@D[Debug] 5-minute pulse reached. Executing auto-report.")
        end
        
        -- Trigger your report function here
        -- Replace 'DoFiveMinuteReport()' with the actual name of your reporting function
        if type(DoFiveMinuteReport) == "function" then
            DoFiveMinuteReport()
        end
        
        timer_count = 0
        SaveState() -- Frequent saves to prevent data loss
    end
end

function ManualReport(name, line, wildcards)
    local chan = wildcards[1]
    local sTdy = 0; for _,v in ipairs(today_times) do sTdy = sTdy + v end
    local avgTdy = (#today_times > 0) and (sTdy / #today_times) or 0
    -- New fluid layout for cleaner manual chat reporting
    local report = string.format("@R[@WPup Report@R] @DDate: @W%s @R| @DPups: @W%s @R| @DTrns: @W%s @R| @DGold: @Y%s @R| @DAvg: @W%s",
                   t_date, CommaValue(t_pups), CommaValue(t_trains), FormatGold(t_gold), FormatSeconds(avgTdy))
    if chan == "print" then AnsiNote(report) else Execute(chan .. " " .. report) end
end

function ToggleTrack()
    report_active = not report_active
    if report_active then fiveMinStats = { pups=0, trains=0, gold=0, times={} }; report_start_time = os.time() end
    AnsiNote("@R[ @WHeracles @R] @GTrack Window: @W" .. (report_active and "STARTED (5-MIN)" or "CANCELED"))
end

function ExecuteReport()
    local s = 0; for _,v in ipairs(fiveMinStats.times) do s=s+v end
    local color_body = string.format("@R[@WTRACKER SUMMARY@R] @DPups: @W%s @R| @DTrns: @W%s @R| @DGold: @Y%s @R| @DAvg: @W%s", 
                       Pad(CommaValue(fiveMinStats.pups), 6), Pad(CommaValue(fiveMinStats.trains), 6), Pad(FormatGold(fiveMinStats.gold), 7), #fiveMinStats.times>0 and FormatSeconds(s/#fiveMinStats.times) or "00s")
    if rep_chan == "print" then AnsiNote("@D"..string.rep("-",80)); AnsiNote(color_body); AnsiNote("@D"..string.rep("-",80))
    elseif rep_chan ~= "none" then Execute(rep_chan .. " " .. color_body) end
    fiveMinStats = { pups=0, trains=0, gold=0, times={} }; report_start_time = os.time()
end

-- PLUGIN INITIALIZATION / SAVE
function tracker_settings(n,l,w) rep_chan = w[1]; SetVariable("repchan", rep_chan); AnsiNote("@R[ @WHeracles @R] @DOutput Channel: @W"..rep_chan) end
function tracker_log_settings(n,l,w) log_tab = w[1]=="off" and "" or w[1]; SetVariable("log_tab", log_tab); AnsiNote("@R[ @WHeracles @R] @DLogging to Tab: @W"..(log_tab=="" and "OFF" or log_tab)) end

function OnPluginInstall()
    -- Uses GetServerDate for universal EST tracking
    t_date = GetServerDate()
    
    t_trains = tonumber(GetVariable("today_trains")) or 0; t_pups = tonumber(GetVariable("today_pups")) or 0; t_gold = tonumber(GetVariable("today_gold")) or 0
    g_corpse, g_crumble, g_split, g_sac, g_sell, g_haggle = tonumber(GetVariable("g_corpse")) or 0, tonumber(GetVariable("g_crumble")) or 0, tonumber(GetVariable("g_split")) or 0, tonumber(GetVariable("g_sac")) or 0, tonumber(GetVariable("g_sell")) or 0, tonumber(GetVariable("g_haggle")) or 0
    rep_chan = GetVariable("repchan") or "print"; log_tab = GetVariable("log_tab") or ""; debug_mode = (GetVariable("debug_mode") == "y")
    
    local h_var = GetVariable("history_table"); if h_var and h_var ~= "" then history = loadstring("return " .. h_var)() or {} end
    local t_var = GetVariable("today_times_table"); if t_var and t_var ~= "" then today_times = loadstring("return " .. t_var)() or {} end
    local a_var = GetVariable("daily_archive"); if a_var and a_var ~= "" then daily_archive = loadstring("return " .. a_var)() or {} end
    
    last_pup_time = GetInfo(304)
    initialized = true

    AnsiNote("@R[ @WHeracles @R] @DPup Tracker Loaded. Type @Cpt help @Dfor commands")
end

function OnPluginSaveState()
    SetVariable("today_date", t_date); SetVariable("today_trains", tostring(t_trains)); SetVariable("today_pups", tostring(t_pups)); SetVariable("today_gold", tostring(t_gold))
    SetVariable("g_corpse", tostring(g_corpse)); SetVariable("g_crumble", tostring(g_crumble)); SetVariable("g_split", tostring(g_split)); SetVariable("g_sac", tostring(g_sac)); SetVariable("g_sell", tostring(g_sell)); SetVariable("g_haggle", tostring(g_haggle))
    SetVariable("repchan", rep_chan); SetVariable("log_tab", log_tab); SetVariable("debug_mode", debug_mode and "y" or "n")
    SetVariable("history_table", serialize.save_simple(history)); SetVariable("today_times_table", serialize.save_simple(today_times)); SetVariable("daily_archive", serialize.save_simple(daily_archive))
end

-- DISPLAY AND COLOR HELPERS
function PrintHeader(title)
    AnsiNote(" "); AnsiNote("@R" .. string.rep("-", 80))
    AnsiNote("@W" .. string.rep(" ", math.floor((80 - #title)/2)) .. title)
    AnsiNote("@R" .. string.rep("-", 80))
end

function AnsiNote(str)
    local colors = {["@R"]="red",["@G"]="lime",["@B"]="blue",["@Y"]="yellow",["@C"]="cyan",["@W"]="white",["@D"]="gray"}
    local current = 1
    while current <= #str do
        local start, stop, code = str:find("(@[RGBYCW D])", current)
        if start then
            if start > current then ColourTell("white", "", str:sub(current, start - 1)) end
            local next_tag = str:find("@[RGBYCW D]", stop + 1)
            local seg_end = (next_tag and next_tag - 1) or #str
            ColourTell(colors[code] or "white", "", str:sub(stop + 1, seg_end))
            current = seg_end + 1
        else
            ColourTell("white", "", str:sub(current)); break
        end
    end
    Note("")
end

function pt_help()
    PrintHeader("HERACLES PUP TRACKER")
    AnsiNote("  @WSYSTEM COMMANDS")
    AnsiNote("  @Cpt chan <channel>           @D: Set auto-output (Ex: @Cgtell@D, @Cclantalk@D, @Cprint@D)")
    AnsiNote("  @Cpt log <tab_name>           @D: Redirect output to Comm Log tab (Ex: @CPups@D)")
    AnsiNote("  @Cpt debug                    @D: Toggle verbose loot math (CURRENT: " .. (debug_mode and "@GON" or "@ROFF") .. "@D)")
    AnsiNote("  @Cpt help                     @D: Displays this menu")
    AnsiNote(" ")
    AnsiNote("  @WREPORTING COMMANDS")
    AnsiNote("  @Cpt track                    @D: Start/Stop 5-minute stat window (CURRENT: " .. (report_active and "@GON" or "@ROFF") .. "@D)")
    AnsiNote("  @Cpt report <channel>         @D: Send manual daily progress report to channel")
    AnsiNote("  @Cpt gold                     @D: Detailed breakdown of gold sources")
    AnsiNote("  @Cpt list <#>                 @D: Breakdown for last X days. Ex: @Wpt list 7")
    AnsiNote("  @Cpt list date <d1> to <d2>   @D: Range Ex: @Wpt list date 1 Jan 2026 to 10 Jan 2026")
    AnsiNote("  @Cpt summary <#>              @D: Total for last X days. Ex: @Wpt summary 30")
    AnsiNote("  @Cpt summary date <d1> to <d2>@D: Range Ex: @Wpt summary date 1 Jan 2026 to 10 Jan 2026")
    AnsiNote("@R" .. string.rep("-", 80))
    AnsiNote("  @WCURRENT STATUS:")
    AnsiNote("  @DSystem Date: @W" .. t_date)
    AnsiNote("  @DOutput Chan: @W" .. rep_chan .. " @D| Logging Tab: @W" .. (log_tab == "" and "OFF" or log_tab))
    AnsiNote("@R" .. string.rep("-", 80)); AnsiNote(" ")
end
]]>
</script>
</muclient>